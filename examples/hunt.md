This tutorial explains how to use hunt to locate and recover deleted and/or damaged TrueCrypt containers. 

These techniques will help you locate the containers but you will require either the password or a memory dump containing the container keys. 

Example #1 – a container in unallocated space
=============================================

The example was generated by creating an NTFS volume, placing the target TrueCrypt container inside the volume, and then reformatting the volume with NTFS again. 

This is a contrived example. There are no other files to cause confusion, there is no fragmentation of the container, and none of the TrueCrypt container has been overwritten. It is possible to simply extract the container just by looking at the image and finding the large section of high entropy data. Nevertheless, this should help provide the basic understanding of the process. 

This tutorial talks about sectors and makes the assumption that they are always 512 bytes in size when you see the word sector think 512 bytes of data. 

[Download the example image here.](https://raw.githubusercontent.com/4144414D/pytruecrypt/gh-pages/resources/example.zip)

```
MD5 checksum:    f45df1f19969cc9007d11ce742a5f0ad
SHA1 checksum:   c5e66174a9b6930138f0918171bcca51ed0a88ed
```

How hunt locates the container
------------------------------

Before running hunt it is important to understand how hunt is locating the container. 

It provides two options:
- A brute force approach for testing all sectors of the image. This is extremely slow and is only useful if you have already extracted what you think is a TrueCrypt header. 
- A chain approach where it looks for sequential sectors of high entropy data. 

This tutorial only discusses the chain approach. 

The diagram below shows the entropy (Shannon entropy) of each sector on the disk. We can see a large section of high entropy data from around sector 27701 to around 48476. This is the container. By looking for sections of continuous high entropy we can target the likely locations of TrueCrypt headers. By checking the sectors around 27701 and 48476 we are able to check a small number of sectors as every check will take some time, particularly on VeraCrypt headers. 

![Entropy](https://raw.githubusercontent.com/4144414D/pytruecrypt/gh-pages/resources/entropy-diagram.png)

You are not required to do any of this work yourself. hunt will calculate the entropy and do this targeting for you. This section is just explaining what is happening.
 
A few warnings. There will, of course, be high other sections of high entropy on a normal disk. Files such as compressed images or zip files will themselves have high entropy. The time wasted by attempting to decrypt these can be avoided by using a high sector chain count. This works because containers are typically quite large and should stand out against these other files. 

It is possible to create a container with low entropy and with smaller sections of high entropy. This happens if the ‘dynamic’ option is chosen when creating the container. If this is the case you need to look for the header itself which is only 256 sectors in size. This will cause many more false positives as other files with high entropy may be this small. 

Running hunt
------------

For this example hunt is called with the following command:

```hunt example.001 password –chain=256```

The options are as follows:
-	example.001 – this is the filename of the example dd image
-	password – this is the password for the container
-	chain=256 – this is the minimum size of the chain that hunt will look for

hunt will look like this when it is run. It starts by calculating the entropy of each sector in the image. It will then locate chains of high entropy. Once these chains have been located it will begin testing sectors looking for valid headers. 

We can see that it started checking at sector 28152 and found a fully valid header at sector 28160. This whole process took less than a minute and is much faster than trying brute force and test every sector in the image. 
 
 ![Entropy](https://raw.githubusercontent.com/4144414D/pytruecrypt/gh-pages/resources/cmd-example.png)
 
The headers that have been located are also saved into a text file named results.txt. In this example, two headers were located. This is expected as each container will have a normal header and a backup header. Looking at the decrypted header we can see that they are identical. Please note that they will appear different on the disk as they are encrypted with different salts. 

```
Sector 28160: Fully valid header found
	Hash Option: ripemd
	Crypto Option: ['aes']
	Password: password

Decrypted Header:
0000  54 52 55 45 00 05 07 00 2e c2 dd d8 00 00 00 00   TRUE............
0010  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0020  00 00 00 00 00 00 00 00 00 9c 00 00 00 00 00 00   ................
0030  00 02 00 00 00 00 00 00 00 9c 00 00 00 00 00 00   ................
0040  00 00 02 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0080  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0090  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
00a0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
00b0  00 00 00 00 00 00 00 00 00 00 00 00 b1 2d f8 8c   .............-..
00c0  f3 00 d5 78 08 30 66 2f 17 99 08 27 28 17 c2 20   ...x.0f/...'(.. 
00d0  b7 2e 9a 14 79 da 01 77 63 98 37 af 75 da 95 41   ....y..wc.7.u..A
00e0  93 1f f6 7e 13 d3 b3 c5 de f2 2f cc 00 b5 98 b9   ...~....../.....
00f0  77 55 00 d4 5b b4 e4 7c 77 7e 5e 65 a3 ec 32 c3   wU..[..|w~^e..2.
0100  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0110  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0120  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0130  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0140  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0150  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0160  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0170  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0180  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0190  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
01a0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
01b0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................

Sector 48384: Fully valid header found
	Hash Option: ripemd
	Crypto Option: ['aes']
	Password: password

Decrypted Header:
0000  54 52 55 45 00 05 07 00 2e c2 dd d8 00 00 00 00   TRUE............
0010  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0020  00 00 00 00 00 00 00 00 00 9c 00 00 00 00 00 00   ................
0030  00 02 00 00 00 00 00 00 00 9c 00 00 00 00 00 00   ................
0040  00 00 02 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0080  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0090  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
00a0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
00b0  00 00 00 00 00 00 00 00 00 00 00 00 b1 2d f8 8c   .............-..
00c0  f3 00 d5 78 08 30 66 2f 17 99 08 27 28 17 c2 20   ...x.0f/...'(.. 
00d0  b7 2e 9a 14 79 da 01 77 63 98 37 af 75 da 95 41   ....y..wc.7.u..A
00e0  93 1f f6 7e 13 d3 b3 c5 de f2 2f cc 00 b5 98 b9   ...~....../.....
00f0  77 55 00 d4 5b b4 e4 7c 77 7e 5e 65 a3 ec 32 c3   wU..[..|w~^e..2.
0100  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0110  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0120  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0130  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0140  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0150  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0160  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0170  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0180  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0190  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
01a0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
01b0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```


At this point will know where the headers are and could simply now export the data. However, it is good practice to parse the header and verify our findings. The simplest way to do this is to use the ‘dump.py’ example.  Hunt will extract the sectors that are likely to be headers to separate small dd files, in this case, PS28160.dd and PS48384.dd. The names showing they came from physical sector 28160 and 48384 respectively. 

The command is simply dump.py PS28160.dd. You will then be prompted for the password. This will dump the raw header and then they extracted values for convenience. 
 
 ![Entropy](https://raw.githubusercontent.com/4144414D/pytruecrypt/gh-pages/resources/cmd-dump.png)

The extracted values for this example are:

```
Magic : TRUE
HdrVersion : 5
MinProgVer : 7
CRC : 784522712
Reserved :                 
HiddenVolSize : 0
VolSize : 10223616
DataStart : 131072
DataSize : 10223616
Flags : 0
SectorSize : 512
Reserved2 :                                                                                                                         
CRC3 : 2972579980
Keys : f300d5780830662f179908272817c220b72e9a1479da0177639837af75da9541931ff67e13d3b3c5def22fcc00b598b9775500d45bb4e47c777e5e65a3ec32c3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
```

In this example, we are interested in DataStart and DataSize. We will check that the backup header was found in the right location and will help us know that the file is not fragmented. 

To check this the formula we need is:

```
header_location + ((DataStart + DataSize) / 512) = backup_location
```

Which for this example is:

```
28160 + ((131072 + 10223616) / 512) = 48384
```

48384 is the correct location for the backup header that was located. Therefore we can be reasonably confident that we have located the entire container and there is no fragmentation. If this formula does not point to the backup header then further work will be required, this is not covered here. 
We can now extract the entire container and open it with TrueCrypt. dd is one of the many tools that could do this. The dd command for this example is:

```dd if=example.001 of=recovered.tc bs=512 skip=28160 count=20480```

![Entropy](https://raw.githubusercontent.com/4144414D/pytruecrypt/gh-pages/resources/cmd-dd.png)
 
The resulting container can then be opened in TrueCrypt. 

![Entropy](https://raw.githubusercontent.com/4144414D/pytruecrypt/gh-pages/resources/tc-mount.png)
 
Once mounted we can use the container in the normal way:

![Entropy](https://raw.githubusercontent.com/4144414D/pytruecrypt/gh-pages/resources/tc-mounted.png)
 
We can see it simply contains a single image file:

![Entropy](https://raw.githubusercontent.com/4144414D/pytruecrypt/gh-pages/resources/file.bmp)
 



Example #2 – a damaged container 
================================
TBA

Example #3 – an unallocated and fragmented container 
====================================================
TBA
